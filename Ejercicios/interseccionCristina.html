<!DOCTYPE html>
<html>
  <head>
    <title>INTERSECTION LIST</title>
  </head>
  <body>
    PRIMERA LISTA:
    <ul id="lista1">
      <li>manzana</li>
      <li>pera</li>
      <ul>
        <li>conferencia</li>
        <ul>
          <li>conferenciaverde</li>
          <li>conferenciaamarilla</li>
          <li>conferenciaroja</li>
        </ul>
        <li>peradeagua</li>
        <li>peritadulce</li>
        <ul>
          <li>Dimas</li>
          <li>Gestas</li>

          <li>Malakatos</li>
          <li>Jose</li>
        </ul>
      </ul>
      <li>limon</li>
      <li>limon</li>
      <li>LIMON</li>
    </ul>
    Segunda lista:
    <ul id="lista2">
      <li>manzana</li>
      <li>manzana</li>
      <li>manzana</li>
      <li>manzana</li>
      <li>pera</li>
      <li>limon</li>
    </ul>

    <script>
      //el contenido del script lo colocaré aquí
      //Metemos las dos listas en variables
      let lista1 = document.getElementById("lista1");
      let lista2 = document.getElementById("lista2");

      //Extraemos el texto que hay dentro y lo almacenamos en listas(incluyendo hijos)
      //Es como hacer un flat(Infinity)
      function texto(lista) {
        let resultado = [];
        for (let i = 0; i < lista.children.length; i++) {
          let hijo = lista.children[i].children;
          if (hijo.length > 0) {
            resultado = resultado.concat(texto(lista.children[i]));
          } else {
            resultado.push(lista.children[i].innerHTML);
          }
        }
        return resultado;
      }

      //Nuevas listas creadas
      let arrLista1 = texto(lista1);
      let arrLista2 = texto(lista2);

      //Buscamos los que tienen en común
      function comun(lista1, lista2) {
        let resultado = [];

        lista1.map((x) => {
            //Si el elemento de la segunda lista y de la primera coinciden y no está en la lista de resultado 
          if (
            lista2.find((y) => y.toUpperCase() === x.toUpperCase()) &&
            !resultado.find((y) => y.toUpperCase() === x.toUpperCase())
          )
          //Lo pusheamos
            resultado.push(x);
        });

        //Devolvemos el resultado
        return resultado;
      }

      //Mostramos por consola las listas
      console.log(comun(arrLista1, arrLista2));
    </script>
  </body>
</html>
